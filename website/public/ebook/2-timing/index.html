<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:100%/1.625 -apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}h1{margin-left:0;margin-right:0;margin-top:2.4375rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.21875rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h2{margin-left:0;margin-right:0;margin-top:1.625rem;padding-bottom:calc(0.40625rem - 1px);padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.40625rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;border-bottom:1px solid hsla(0,0%,0%,0.07);}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:inherit;font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;color:hsla(0,0%,0%,0.53);font-family:-apple-system,'BlinkMacSystemFont','Segoe UI','Roboto','Helvetica','Arial',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-weight:600;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}ul{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.625rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:0.85rem;line-height:1.625rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;font-size:1rem;line-height:1.625rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}blockquote{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:calc(0.8125rem - 1px);padding-right:0;padding-top:0;margin-bottom:0.8125rem;border-left:4px solid hsla(0,0%,0%,0.13);color:hsla(0,0%,0%,0.53);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(0.8125rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:0.8125rem;}b{font-weight:600;}strong{font-weight:600;}dt{font-weight:600;}th{font-weight:600;}li{margin-bottom:calc(0.8125rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}li > ul{margin-left:1.625rem;margin-bottom:calc(0.8125rem / 2);margin-top:calc(0.8125rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(0.8125rem / 2);}code{font-size:0.85rem;line-height:1.625rem;}kbd{font-size:0.85rem;line-height:1.625rem;}samp{font-size:0.85rem;line-height:1.625rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.08333rem;padding-right:1.08333rem;padding-top:0.8125rem;padding-bottom:calc(0.8125rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}h3,h4,h5,h6{margin-bottom:0.8125rem;margin-top:1.625rem;}ol,ul{margin-left:2.03125rem;}li>ol,li>ul{margin-left:2.03125rem;}a{color:#4078c0;text-decoration:none;}a:hover,a:active{text-decoration:underline;}ol, ul{margin-left:16px;}</style><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><title data-react-helmet="true">2. Timing Your Code | Another C Library</title><meta data-react-helmet="true" name="description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:title" content="2. Timing Your Code"/><meta data-react-helmet="true" property="og:description" content="A documentation site for Another C Library."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="Daniel Curtis"/><meta data-react-helmet="true" name="twitter:title" content="2. Timing Your Code"/><meta data-react-helmet="true" name="twitter:description" content="A documentation site for Another C Library."/><style type="text/css">
    .anchor {
      float: left;
      padding-right: 4px;
      margin-left: -20px;
    }
    h1 .anchor svg,
    h2 .anchor svg,
    h3 .anchor svg,
    h4 .anchor svg,
    h5 .anchor svg,
    h6 .anchor svg {
      visibility: hidden;
    }
    h1:hover .anchor svg,
    h2:hover .anchor svg,
    h3:hover .anchor svg,
    h4:hover .anchor svg,
    h5:hover .anchor svg,
    h6:hover .anchor svg,
    h1 .anchor:focus svg,
    h2 .anchor:focus svg,
    h3 .anchor:focus svg,
    h4 .anchor:focus svg,
    h5 .anchor:focus svg,
    h6 .anchor:focus svg {
      visibility: visible;
    }
  </style><script>
    document.addEventListener("DOMContentLoaded", function(event) {
      var hash = window.decodeURI(location.hash.replace('#', ''))
      if (hash !== '') {
        var element = document.getElementById(hash)
        if (element) {
          var offset = element.offsetTop
          // Wait for the browser to finish rendering before scrolling.
          setTimeout((function() {
            window.scrollTo(0, offset - 0)
          }), 0)
        }
      }
    })
  </script><link rel="shortcut icon" href="/icons/icon-48x48.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="manifest" href="/manifest.webmanifest"/><meta name="generator" content="Gatsby 2.18.14"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=b48ffc73e97be239d297f69a5b2c56e5"/><style data-href="/styles.77dda24363f4e378cb42.css">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}a{text-decoration:none;cursor:pointer;color:#3182ce}a:hover{text-decoration:underline}button:hover{-webkit-transition:.6s;transition:.6s;-webkit-filter:brightness(115%);filter:brightness(115%)}nav{display:flex;align-items:center}li{margin-bottom:3px}pre[class*=language]{overflow-x:scroll}:not(pre)>code[class*=language],pre[class*=language]{border-radius:0;background:#f6f8fa;font-family:SFMono-Regular,Consolas,Liberation Mono,Menlo,monospace;text-shadow:none}:not(pre)>code[class*=language]{color:#000;padding:3px}.Footer{max-width:1200px;margin:30px auto;display:flex;justify-content:space-between}.Flex{display:grid;grid-template-columns:auto auto;grid-column-gap:50px}.Content{max-width:950px;width:72vw}@media only screen and (max-width:600px){.Footer,nav{flex-direction:column}.Flex{grid-template-columns:auto}.Sidebar{display:none}.Content{width:100%}}</style><link as="script" rel="preload" href="/component---src-templates-ebook-page-js-4f86bfce78e35e0955d6.js"/><link as="script" rel="preload" href="/commons-112db262b175fed05b80.js"/><link as="script" rel="preload" href="/app-fb5291d31b0f12597e81.js"/><link as="script" rel="preload" href="/styles-a8f8354e20700922ebe9.js"/><link as="script" rel="preload" href="/webpack-runtime-277776b5a5692f7fc3b0.js"/><link as="fetch" rel="preload" href="/page-data/ebook/2-timing/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div style="background-color:white"><header style="position:sticky;top:0;background-color:#1A202C;z-index:1"><nav style="margin:auto;max-width:1200px"><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/"><span style="font-weight:700">Another C Library</span></a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" href="/docs/">Documentation</a><a style="color:#38A169;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;border-bottom:solid 4px #2F855A;background-color:#2D3748" class="" href="/ebook/">A C eBook</a><a style="color:white;font-size:1.25rem;padding:1rem 1.5rem;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif" target="_blank" rel="noopener noreferrer" href="https://github.com/contactandyc/another-c-library">Github <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" style="padding-top:5px" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></nav></header><main><div style="margin:0 auto;max-width:1200px;display:flex"><div style="color:black;margin:0;padding:20px" class="Content"><h1>2. Timing Your Code</h1><div><p>Copyright 2019 Andy Curtis &#x26; Daniel Curtis</p>
<h1 id="timing-your-code-the-first-project"><a href="#timing-your-code-the-first-project" aria-label="timing your code the first project permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Timing Your Code (the first project)</h1>
<h2 id="a-brief-introduction-to-c"><a href="#a-brief-introduction-to-c" aria-label="a brief introduction to c permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>A brief introduction to C</h2>
<p>In the project, there is an illustrations folder that contains most of the code.  There is also a src directory where the final code exists.  Normally, one would start with a hello world project. That exists later in a section called Hello Buffer.  If you are lost, hopefully, it will make more sense once you get to the Hello Buffer section. I would recommend reading and working through the examples in this chapter and then coming back after working through Hello Buffer.  The code for this chapter is located in <i>illustrations/2_timing</i></p>
<p>At various points in this project, we will be timing code in an attempt to optimize it.  Our first object is going to be simple but will illustrate how I plan to maintain separation between interfaces and their respective implementation.</p>
<p>The following code is found in <i>illustrations/2<em>timing/1</em>timer</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/illustrations/2_timing/1_timer</code></pre></div>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ make
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ =&gt; ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: 49.0980ns
Reverse =&gt; esreveR
time_spent: 23.1360ns
overall time_spent: 72.2340ns</code></pre></div>
<p>test_timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>e <span class="token operator">=</span> s<span class="token operator">+</span>len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>s <span class="token operator">&lt;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>
    <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
    <span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    s<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">long</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> repeat_test <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
  <span class="token keyword">long</span> overall_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> test_t1 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">long</span> test_t2 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    overall_time <span class="token operator">+=</span> <span class="token punctuation">(</span>test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000.0</span><span class="token operator">/</span><span class="token punctuation">(</span>repeat_test<span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"overall time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> overall_time<span class="token operator">*</span><span class="token number">1000.0</span><span class="token operator">/</span><span class="token punctuation">(</span>repeat_test<span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Every C program that is capable of being executed has a main function.  The main function typically has the following two parameters to pass in command-line arguments to the program. <code class="language-text">argc</code> represents the number of arguments. The name of the program is the 1st argument. <code class="language-text">argv</code> represents the arguments. <code class="language-text">argv[0]</code> references the name of the program as called from the command line. The main function returns an integer. Successful execution should return 0, which lets the command shell know that the program finished normally.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>C has a few built-in data types:</p>
<table>
<thead>
<tr>
<th>Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>char</td>
<td>a single byte</td>
</tr>
<tr>
<td>short</td>
<td>two bytes</td>
</tr>
<tr>
<td>int</td>
<td>four bytes</td>
</tr>
<tr>
<td>long</td>
<td>typically eight bytes</td>
</tr>
<tr>
<td>size_t</td>
<td>on a 64-bit system, 8 bytes (or 64 bits), on a 32-bit system, 4 bytes (or 32 bits)</td>
</tr>
<tr>
<td>ssize_t</td>
<td>signed size_t</td>
</tr>
<tr>
<td>bool</td>
<td>can be different sizes, but only has two states (true and false)</td>
</tr>
<tr>
<td>float</td>
<td>four-byte decimal (I try to avoid this type as it quickly loses precision)</td>
</tr>
<tr>
<td>double</td>
<td>eight-byte decimal</td>
</tr>
<tr>
<td>void</td>
<td>this does not have a size and is a special type</td>
</tr>
</tbody>
</table>
<p>A byte represents 8 bits.  The range of 1 bit would be 0-1, two bits 0-3, etc. For 8 bits, the range is 0-255.  The short has a range of 0-((256*256)-1) or 0-65535.  C counts from 0 (all bits off) instead of 1.  Types can be signed (the default) or unsigned.  If the data type is unsigned, the number range will start with zero.  Otherwise, the number range will be between -(2^(number of bits-1)) and (2^(number of bits-1))-1.  A signed char will range from -128 to 127.  A signed char and a char are the same things.</p>
<p><code class="language-text">size_t</code> is a type that is defined in C to represent the number of bits that the CPU is and is unsigned (meaning it cannot be negative). <code class="language-text">ssize_t</code> is a signed alternative.  On a 64-bit system, a long and <code class="language-text">ssize_t</code> are equivalent.</p>
<p>You can overflow a type.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> a <span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>
a <span class="token operator">=</span> a <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// a will become zero</span>
a <span class="token operator">=</span> a <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// a will become 255 again</span>
<span class="token keyword">char</span> b <span class="token operator">=</span> <span class="token number">127</span><span class="token punctuation">;</span>
b <span class="token operator">=</span> b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// b will become -128</span>
b <span class="token operator">=</span> b <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// b will become 127 again</span></code></pre></div>
<p><code class="language-text">bool</code> is another type defined in C (you must include <code class="language-text">stdbool.h</code> to get it). <code class="language-text">bool</code> is defined as having the value true or false. This type can make code more readable in that it makes it clear to the reader that there are only two possible states.</p>
<p><code class="language-text">double</code> (and <code class="language-text">float</code>) are used for decimals.  Because <code class="language-text">float</code> only uses 32 bits, it loses precision quickly.  I do not tend to use it for anything.  Instead, I opt to use <code class="language-text">double</code>.</p>
<p><code class="language-text">typedef</code> can be utilized to define your own type using the following syntax:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">typedef &lt;existing type&gt; &lt;new type name&gt;;</code></pre></div>
<p>For example, the following would define a new type called number_t, which has an underlying type of unsigned int.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> number_t<span class="token punctuation">;</span>

number_t a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span></code></pre></div>
<p>Every data type in C has a size.  The size of a pointer is always the same (it is the same as the size<em>t type). The <code class="language-text">sizeof()</code> operator determines the size of a type or variable. `sizeof(number</em>t)<code class="language-text">finds the size of the</code>number_t<code class="language-text">type (and return four since unsigned int is four bytes).</code>sizeof(void)` is not allowed as that does not make sense.</p>
<p>A variable can be cast from one type to another, either implicitly or explicitly.  Imagine you want to convert an int to a double or vice versa.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>
y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%d\n"</span><span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// would print 100</span></code></pre></div>
<p>When the casting happens, precision is lost if the new type cannot accommodate for the value.  The above example shows casting happening implicitly.  Below is an example of casting happening explicitly.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>x<span class="token punctuation">;</span> <span class="token comment">// explicit cast</span>
y <span class="token operator">=</span> y <span class="token operator">+</span> <span class="token number">0.05</span><span class="token punctuation">;</span>
x <span class="token operator">=</span> y<span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%d\n"</span><span class="token punctuation">,</span> x <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// would print 100</span></code></pre></div>
<p>Variables are typically declared as</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">datatype variable_name <span class="token operator">=</span> value<span class="token punctuation">;</span></code></pre></div>
<p>or</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">datatype variable_name<span class="token punctuation">;</span></code></pre></div>
<p>In the main function declaration, <code class="language-text">argv</code> is declared uniquely.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span></code></pre></div>
<p>The asterisk means that the variable named <code class="language-text">argv</code> is a pointer to the type <code class="language-text">char</code>, which is a single byte and is signed (signed is the default datatype prefix).  The <code class="language-text">[]</code> after the <code class="language-text">argv</code> indicates that <code class="language-text">argv</code> is referencing an array of pointers.</p>
<p>In the following array</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">0123456789012345678901234567
./test_timer This is a test</code></pre></div>
<p><code class="language-text">argv</code> would be an array of pointers<br/>
<code class="language-text">argv[0] =&gt; .</code> (at byte 0)<br/>
<code class="language-text">argv[1] =&gt; T</code> (at byte 13)<br/>
<code class="language-text">argv[2] =&gt; i</code> (at byte 18)<br/>
<code class="language-text">argv[3] =&gt; a</code> (at byte 21)<br/>
<code class="language-text">argv[4] =&gt; t</code> (at byte 23)<br/>
<code class="language-text">argv[5] =&gt; NULL</code> (pointing to NULL means that the pointer is not pointing at anything)<br/></p>
<p>Notice that the pointers refer to individual bytes.  In C (and any language), a pointer refers to a location in memory (typically RAM or random access memory).  Strings or sequences of characters are defined by looking for a terminating character (a non-printable 0).  The above example is not technically correct in that what would happen is before the arguments getting to the main function; they would split into five strings.</p>
<p><code class="language-text">argv</code> would be an array of pointers<br/>
<code class="language-text">argv[0] =&gt; &quot;./test_timer&quot;</code><br/>
<code class="language-text">argv[1] =&gt; &quot;This&quot;</code><br/>
<code class="language-text">argv[2] =&gt; &quot;is&quot;</code><br/>
<code class="language-text">argv[3] =&gt; &quot;a&quot;</code><br/>
<code class="language-text">argv[4] =&gt; &quot;test&quot;</code><br/>
<code class="language-text">argv[5] =&gt; NULL</code> (pointing to NULL means that the pointer is not pointing at anything)<br/></p>
<p>The string "This" above is 4 bytes long but requires 5 bytes to be represented.  To determine the length of a string in C, you would advance a pointer until the zero is referenced.  Simple implementation to find the length of a string might look like:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This function returns an integer (so it will only support finding the length of strings that are 2,147,483,647 or fewer bytes).  The function's name is <code class="language-text">strlen</code>.  It takes as an input a single pointer to a byte in RAM.  The pointer is of type char.  Imagine that s pointed to the first character in the string "This" (or the letter T).  This function seeks to find a pointer to the byte that is just past the end of the string (or just after the letter s) and then subtracts the two pointers.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">This
^   ^
|   |
s   p</code></pre></div>
<p>The value of subtracting s from p is 4.  </p>
<p>The steps to finding the length of a string in C are</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1. given a pointer to a character, make a copy of the pointer.
2. while the pointer does not point to the non-printable zero, increment the pointer by 1.
3. return the difference between p and s.</code></pre></div>
<p>Pointers always reference specific bytes in RAM.  In most languages, the pointer is defined to reference a type.  The appropriate number of bytes would be advanced depending on whether the pointer is incremented, subtracted, added, etc. A <code class="language-text">char *</code> is a pointer that references a sequence of bytes that are of type <code class="language-text">char</code>.  The <code class="language-text">char</code> is a single byte, so advancing a pointer to a char by one is the same as incrementing the pointer by 1 byte.</p>
<p>Make a copy of the pointer s and call it p.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span></code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span></code></pre></div>
<p>C allows for repeated logic until a given condition evaluates true.  For example, a while loop is technically defined as</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">></span><span class="token punctuation">)</span>
  do_something<span class="token punctuation">;</span></code></pre></div>
<p>Alternatively, if there are multiple lines of code which need to be executed within the loop:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>condition<span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  do_something1<span class="token punctuation">;</span>
  do_something2<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  do_somethingN<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>It is essential to recognize the difference between comparisons and conditions.  A condition can be true or false.  Comparisons require two objects and can evaluate to true or false.  In most (every?) computer language, loops, and if logic will use conditions as opposed to comparisons.  Comparisons are a subset of conditions.  In C, true is non-zero, and false is zero.</p>
<p>The following would never do_something:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  do_something<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The following would never stop executing do_something:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  do_something<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Back to the original example,</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span></code></pre></div>
<p>Pointers are declared using an asterisk. Pointers point at values obtained through a process called dereferencing. Dereferencing occurs when an asterisk precedes the pointer. The first time through this loop, assuming that s pointed to "Test", p would be pointing at a value T.  *p would result in the single character 'T'.  In C, single quotes define single characters.  Double-quotes define longer strings.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* first time *p == 'T', condition is true ('T' != 0) */</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">/* advance p to point to the next character 'h' */</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* second time *p == 'h', condition is true ('h' != 0) */</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">/* advance p to point to the next character 'i' */</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* third time *p == 'i', condition is true ('i' != 0) */</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">/* advance p to point to the next character 's' */</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* fourth time *p == 's', condition is true ('s' != 0) */</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">/* advance p to point to the next character (non printable zero) */</span>

<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">/* fifth time *p == 0, so condition is no longer true */</span></code></pre></div>
<p>At this point, p points to just passed the letter s and advanced four times, so the length is four.</p>
<p>It is common for developers to use <code class="language-text">int</code> as a return type. However, it is generally more efficient and less bug-prone to use <code class="language-text">size_t</code>.  For a 64 bit CPU to work with an <code class="language-text">int</code>, it must split a register since the CPU is meant to work with 64-bit integers.  This split is not cheap.  Additionally, if you use <code class="language-text">size_t</code> or (<code class="language-text">ssize_t</code> for signed numbers), the program will be more portable to 64-bit systems where a string might be longer than 2 billion bytes.  A better implementation of <code class="language-text">strlen</code> might look like the following.  The only difference is that the <code class="language-text">strlen</code> returns a type <code class="language-text">size_t</code>.  Strings cannot be negative in length, so returning an unsigned number also helps people using the function to understand that.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>C allows for variables to be declared as constant, meaning that they cannot change.  Constants are particularly useful in functions because the function can indicate that the input will not change.  Above, the string remains unmodified while determining the length.  Adding <code class="language-text">const</code> will indicate to the user (and compiler) that what s points to will not be changed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span> <span class="token comment">// p must also be declared with const</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Another minor optimization to the function above is to look at the while loop. The while loop expects a condition.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span></code></pre></div>
<p>can be changed to:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token punctuation">)</span></code></pre></div>
<p>because the check for 0 is redundant.  It doesn't hurt anything to add the != 0, and sometimes it makes code easier to read.</p>
<h2 id="the-void-type"><a href="#the-void-type" aria-label="the void type permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The void type</h2>
<p>A function with a return type of void means that the function does not expect to return anything. An example might be:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">print_hello</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello %s\n"</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This function prints something to the screen and does not return anything.</p>
<p>A void pointer: <code class="language-text">void *</code>, is a special type of pointer that must cast to another type before implementation.</p>
<p>Before describing the void pointer, I want to show an example of casting pointers.</p>
<p>The following would produce a warning:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">warning: initializing <span class="token string">'char *'</span> with an expression of <span class="token builtin class-name">type</span> <span class="token string">'const char *'</span> discards qualifiers</code></pre></div>
<p>To avoid such a warning, either change the type of p to <code class="language-text">const char *</code> or cast s to <code class="language-text">char *</code></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>s<span class="token punctuation">;</span></code></pre></div>
<p>Imagine you have a function that will print the value of variables of different types, such as the following.</p>
<p>Code found in <i>illustrations/2<em>timing/1</em>timer</i></p>
<p>void_pointers.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">void</span> <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token keyword">char</span> type<span class="token punctuation">,</span> <span class="token keyword">void</span> <span class="token operator">*</span>p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'c'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"char type: %d (%c)\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp<span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'C'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned char type: %u\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'s'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">short</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">short</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"short type: %d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'S'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">short</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned short type: %u\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'i'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">int</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"int type: %d\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'I'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned int type: %u\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'l'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">long</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"long type: %ld\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'L'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned long type: %lu\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>type <span class="token operator">==</span> <span class="token string">'d'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">double</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"double type (with 4 decimal places): %0.4f\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> a <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// notice that printable 0 is actually 48</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">char</span> b <span class="token operator">=</span> <span class="token number">150</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'C'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">short</span> c <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">5000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">short</span> d <span class="token operator">=</span> <span class="token number">5000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'S'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">int</span> e <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">500000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">int</span> f <span class="token operator">=</span> <span class="token number">500000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'I'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">long</span> g <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">500000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'l'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>g<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> h <span class="token operator">=</span> <span class="token number">500000</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> i <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
  <span class="token function">print_value_of_pointer</span><span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>If you build the program using</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">gcc void_pointers.c -o void_pointers -Wall</code></pre></div>
<p>and run it</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">./void_pointers</code></pre></div>
<p>You should see the following output.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">char type: 48 (0)
unsigned char type: 150
short type: -5000
unsigned short type: 5000
int type: -500000
unsigned int type: 500000
long type: -500000
unsigned long type: 500000
double type (with four decimal places): 1.5000</code></pre></div>
<p>In the program above, the void pointer cannot be used directly.  It must be converted to a different pointer type before the value that the pointer is pointing at can be referenced.  </p>
<p>The program above introduced <code class="language-text">if</code>, <code class="language-text">else if</code>, and the <code class="language-text">&amp;</code> operator.  If statements have similar syntax as while statements.  </p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">if(&lt;condition&gt;) {
  zero or more statements;
}
else if(&lt;condition&gt;) {
  zero or more statements;  
}
else {
  zero or more statements;
}</code></pre></div>
<p>The curly braces are not needed if there is exactly one statement.</p>
<p><code class="language-text">else if</code> works in connection with <code class="language-text">if</code>.  <code class="language-text">else if</code> only happens if the if (or else if statements above it) have not been evaluated to equal a true condition.  Finally, else does not expect a condition and essentially becomes the default block to run if all other conditions were evaluated to be false.  It is also essential to realize the difference between = and ==.  A single equal statement is used for assignment.  A double equal statement indicates an equality test.</p>
<p>In code below, p was of type <code class="language-text">void *</code>.  It must be converted before it can be dereferenced (to get the value of what p is pointing at).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span>vp <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">;</span>
<span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned char type: %u\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span>vp <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The code above can be shortened to:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"unsigned char type: %u\n"</span><span class="token punctuation">,</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span>p <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>You will find the above shortening often.  I used the two-line version to make what was happening clear.
Placing an asterisk before a pointer results in getting the value of what the pointer is pointing at.  Placing an ampersand before a value results in a pointer to the value.  For example:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">double</span> a <span class="token operator">=</span> <span class="token number">1.5</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token operator">&amp;</span>a<span class="token punctuation">;</span>  <span class="token comment">// p points to the value 1.5</span></code></pre></div>
<h2 id="what-happens-during-compilation"><a href="#what-happens-during-compilation" aria-label="what happens during compilation permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What happens during compilation</h2>
<p>In C, code converts to binary (which is generally very hard for humans to read).  C does not use line separation to separate code (except for compiler directives (lines that start with #)).  In C, there are two types of comments.  /* */ can be multiline comments.  // comments run to the end of the line.  The first thing a compiler does is remove comments.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token comment">/* This function returns the length of a string */</span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span> <span class="token comment">// p must also be declared with const</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p <span class="token operator">=</span> s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Next, it will look for each individual statement, function declarations, loops, etc.  We can remove all of the spacing of the function above.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>p<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre></div>
<p>If you look at the above code, you should be able to see that functions follow the syntax of</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">&lt;return type&gt; &lt;function name&gt;([arguments]){[statements]}</code></pre></div>
<p>Semicolons form natural breaks.  If the while loop only has one statement, it does not need curly braces.  Lets slowly introduce space back into the code above.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>p<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token punctuation">}</span></code></pre></div>
<p>Introduce new lines after the opening and closing braces of functions.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>p<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Indent code within the braces by two spaces</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>p<span class="token operator">++</span><span class="token punctuation">;</span><span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Place a new line after each semicolon.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Place a new line after the while statement</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
  p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Indent the line following the while statement to make it clear that that line belongs to the loop.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p<span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Introduce extra spacing to separate the functions and the include statements.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

size_t <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>p<span class="token operator">=</span>s<span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>p <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
    p<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> p<span class="token operator">-</span>s<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Hello World (%ld)\n"</span><span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string">"Hello World"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The syntax is necessary for the C compiler to understand where one statement ends and the next starts.  All of the above examples compile and will work the same.  The last example is easier to read.  C does not force you to make the code easy to read.  It is just an excellent idea to do so!</p>
<p>There are different types of loops in C.  The following defines the <code class="language-text">for</code> loop:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token punctuation">[</span>initialization_code<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">[</span>post_loop code<span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span></code></pre></div>
<p>There are three components of the <code class="language-text">for</code> loop: the initialization<em>code, condition, and post</em>loop code.  Notice the enclosure in square brackets <code class="language-text">[]</code> instead of lesser/greater than signs <code class="language-text">&lt;&gt;</code>.  Square brackets indicate the bit of code is optional.</p>
<p>If there is no initialization<em>code, condition, or post</em>loop code, the for loop will continue forever.  The following example would print the string "Hello World!" followed by a new line character continuously forever (or until the program was stopped).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"Hello World!\n"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>This code will loop through the arguments skipping the name of the program (as it is the first argument in the argv array).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<h2 id="how-to-time-code"><a href="#how-to-time-code" aria-label="how to time code permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to time code</h2>
<p>The example is going to reverse strings several times while timing the process.  The program should not modify the arguments that are passed into your program.  If you wish to modify an argument, you should first allocate memory for your program to use and then copy the argument into the newly allocated memory.  The <code class="language-text">malloc</code> function will allocate the number of bytes requested for use.  You can read about it by typing <code class="language-text">man malloc</code> from the command line.  Programs that require extra memory to work with must request that memory from the operating system.  <code class="language-text">malloc</code> is one of the core ways to complete this.  Memory requested should later be freed using the <code class="language-text">free</code> call.  The <code class="language-text">malloc</code> function can return <code class="language-text">NULL</code>, meaning that the memory was not available.  Trying to writing to a pointer that is pointing at NULL will cause your program to crash.  You can check for the error or just allow the program not so gracefully to crash.  In my examples, I am going to allow the program to crash if <code class="language-text">NULL</code> is returned.  The only other reasonable option would be to have the program fail early, which effectively is the same thing.  In the example below, there are a few functions called.  The early writers of C decided to shorten the names of the functions.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">malloc - memory allocate
strlen - string length
strcpy - string copy</code></pre></div>
<p>Once s is pointing at newly allocated memory which is the string length of <code class="language-text">argv[i] + 1</code> for the zero terminator (the current iteration of the loop), a string copy of the argument is performed, so that s points to a copy of the given argument.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>At the beginning of the program, there were a few <code class="language-text">#include</code> statements.  <code class="language-text">#include</code> effectively copies the contents of the filename into the current program.  To use functions like <code class="language-text">malloc</code>, <code class="language-text">strcpy</code>, and <code class="language-text">free</code>, the proper file must be included.  Files with a suffix ".h" are called header files and typically define how to call a function.  </p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span></code></pre></div>
<p>I include the include statements above because of the following function calls:</p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>stdio.h</td>
<td>printf, NULL, and many other io related functions</td>
</tr>
<tr>
<td>stdlib.h</td>
<td>malloc, free, and many other standard library-related functions</td>
</tr>
<tr>
<td>string.h</td>
<td>strlen, strcpy, and many other string related functions</td>
</tr>
<tr>
<td>sys/time.h</td>
<td>gettimeofday</td>
</tr>
<tr>
<td>time.h</td>
<td>sometimes an alternate location of gettimeofday</td>
</tr>
</tbody>
</table>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">This program is going to time how long the reverse string method takes to run.  To get the amount of time that something takes, one might get a start time and an end time and then subtract the start time from the end time.  The following function will get the time in microseconds (millionths of seconds).  Passing NULL to gettimeofday will cause gettimeofday to return the current time.  The timeval structure consists of two members (the number of seconds and the number of microseconds).  
```c
long get_time() {
  struct timeval tv;
  gettimeofday(&amp;tv, NULL);
  return (tv.tv_sec * 1000000) + tv.tv_usec;
}</code></pre></div>
<p>A quick note on using parenthesis:  I strongly believe in making code easier to read.  Technically, I could have skipped the parenthesis without harm due to the order of operations, but the code becomes simpler to read by adding the parenthesis.</p>
<p>Reversing a string takes a minimal amount of time.  It is so small that to accurately measure it, you need to repeat the test a million times to make a good step.  In each loop, the <code class="language-text">strcpy</code> resets s such that it has a copy of the ith argument so that it can be reversed.  The time that the process takes is <code class="language-text">test_t2 - test_t1</code>.  </p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> repeat_test <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">long</span> test_t1 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">long</span> test_t2 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> time_spent <span class="token operator">=</span> test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">;</span>
overall_time <span class="token operator">+=</span> time_spent<span class="token punctuation">;</span></code></pre></div>
<p>After timing the reverse<em>string call, printf is used to print the string on the terminal before it was reversed and the new form of the string (s).  Printf allows for format specifiers to match arguments after the first parameter (also known as the format string).  <code class="language-text">%s</code> indicates that there must be a string for the given argument.  <code class="language-text">%0.4f</code> expects a floating-point number and prints four decimal places.  test</em>t2 and test_t1 are both measured in microseconds.  Multiplying the difference by 1000 will change the unit type to nanoseconds.  Since the test was repeated 1 million times, the overall time needs to be divided by 1 million.  By multiplying or dividing a number by a decimal, it converts the type to a decimal.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">)</span><span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>repeat_test<span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"overall time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> overall_time<span class="token operator">*</span><span class="token number">1000.0</span><span class="token operator">/</span><span class="token punctuation">(</span>repeat_test<span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="reversing-a-string"><a href="#reversing-a-string" aria-label="reversing a string permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reversing a string</h2>
<p>The last function to examine is the reverse_string call.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>e <span class="token operator">=</span> s<span class="token operator">+</span>len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>s <span class="token operator">&lt;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>
    <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
    <span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    s<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The above code works in the following way.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1.  set a pointer e to the last character in the string.  The last character
    is found by determining the length of the string s and pointing to the
    length-1 char beyond s.
2.  while s is less than e
      swap the value that is pointed to by s and e.
      advance s by one and decrement e by one.</code></pre></div>
<p>Imagine the string "Reverse".  The <code class="language-text">strlen</code> or length of "Reverse" is 7. Subtracting the pointer just after the string from the pointer that points to the beginning of the string, equals 7.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">01234567
Reverse
^      ^
s      e</code></pre></div>
<p>To reverse the string, we need the end pointer to point to the last character 'e'.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">01234567
Reverse
^     ^
s     e</code></pre></div>
<p>The first step is to swap R and e.  In order to swap R and e, a temporary
variable is needed.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>  <span class="token comment">// *s == R</span>
<span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>        <span class="token comment">// *e == e, so now string is equal to eeverse</span>
<span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>       <span class="token comment">// tmp = R, so now string is equal to eeversR</span>
s<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token comment">// s points to the second e</span>
e<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token comment">// e points to s</span></code></pre></div>
<p>The while loop will continue because s is less than e.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">01234567
eeversR
 ^   ^
 s   e</code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>  <span class="token comment">// *s == e</span>
<span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>        <span class="token comment">// *e == s, so now string is equal to esverse</span>
<span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>       <span class="token comment">// tmp = e, so now string is equal to esvereR</span>
s<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token comment">// s points to v</span>
e<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token comment">// e points to r</span></code></pre></div>
<p>The while loop will continue because s is less than e.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">01234567
esvereR
  ^ ^
  s e</code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>  <span class="token comment">// *s == v</span>
<span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>        <span class="token comment">// *e == r, so now string is equal to esrereR</span>
<span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>       <span class="token comment">// tmp = e, so now string is equal to esreveR</span>
s<span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token comment">// s points to the middle e</span>
e<span class="token operator">--</span><span class="token punctuation">;</span>            <span class="token comment">// e points to the middle e</span></code></pre></div>
<p>The while loop will NOT continue because s is not less than e.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">01234567
esvereR
   ^
   s
   e</code></pre></div>
<p>The string is now esreveR, which is the reverse of Reverse.</p>
<h2 id="the-basic-makefile"><a href="#the-basic-makefile" aria-label="the basic makefile permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The basic Makefile</h2>
<p>If you change to that directory, you will find the following Makefile.  </p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">all</span><span class="token punctuation">:</span> test_timer examples

<span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c
	gcc test_timer.c -o test_timer

<span class="token symbol">examples</span><span class="token punctuation">:</span>
	./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse

<span class="token symbol">clean</span><span class="token punctuation">:</span>
	rm -f test_timer *~</code></pre></div>
<p>When you run</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">make</span></code></pre></div>
<p>The first block with a colon will run.  In this Makefile, it is the following line:</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">all</span><span class="token punctuation">:</span> test_timer examples</code></pre></div>
<p>The all group refers to other groups to be built.  In this case, it is test_timer and examples.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c
	gcc test_timer.c -o test_timer

<span class="token symbol">Examples</span><span class="token punctuation">:</span>
	./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse</code></pre></div>
<p>The lines of code after test<em>timer will run if the file called test</em>timer is older than the files after the colon.  If you edit test<em>timer.c, the program will be built using the following line of code.  The output is test</em>timer.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">gcc test_timer.c -o test_timer</code></pre></div>
<p>If you did not want to use a Makefile to build test_timer, you could do so from the command line using the following command.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">gcc test_timer.c -o test_timer</code></pre></div>
<p>The examples block will run every time because it does not have any dependencies, and examples are not a file that exists.  If you were to create a file called examples, then the examples block would cease to run.  By running <code class="language-text">make</code>, you will effectively build test_timer if it needs to build and run the examples block.  Running  <code class="language-text">make clean</code> will clean up the binary.  You can run any block by specifying it. <code class="language-text">make all</code> is equivalent to running <code class="language-text">make</code>.  If you just want to run the examples block, you can by running <code class="language-text">make examples</code>.  </p>
<h2 id="more-accurately-timing-code"><a href="#more-accurately-timing-code" aria-label="more accurately timing code permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>More accurately timing code</h2>
<p>In the last section, we explored how to time the reverse<em>string function.  In this section, we will explore how to time the function better.  One thing you may have noticed is that there are a million calls to both `reverse</em>string<code class="language-text">and</code>strcpy<code class="language-text">.  There is also the overhead of the loop.  To do the timing correctly, we should have timed the</code>strcpy` and the loop and subtracted that from the loop, which has the reverse_string function called.</p>
<p>The timing for the work in <i>illustrations/2<em>timing/2</em>timer</i> was:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">46</span>.4650ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">20</span>.5820ns
overall time_spent: <span class="token number">67</span>.0470ns</code></pre></div>
<p>This section's code is found in <i>illustrations/2<em>timing/2</em>timer</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">35</span>.8950ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">13</span>.7250ns
overall time_spent: <span class="token number">49</span>.6200ns</code></pre></div>
<p>Running <code class="language-text">make</code> yields a 17.5 nanosecond improvement.  The following test demonstrates the difference between 1<em>timer and 2</em>timer:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> test_timer.c <span class="token punctuation">..</span>/1_timer/test_timer.c
<span class="token number">30</span>,35d29
<span class="token operator">&lt;</span>     long copy_t1 <span class="token operator">=</span> get_time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>     for<span class="token punctuation">(</span> int <span class="token assign-left variable">j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j++ <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">&lt;</span>       strcpy<span class="token punctuation">(</span>s, argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>     <span class="token punctuation">}</span>
<span class="token operator">&lt;</span>     long copy_t2 <span class="token operator">=</span> get_time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>
42c36
<span class="token operator">&lt;</span>     long time_spent <span class="token operator">=</span> <span class="token punctuation">(</span>test_t2-test_t1<span class="token punctuation">)</span> - <span class="token punctuation">(</span>copy_t2-copy_t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
---
<span class="token operator">></span>     long time_spent <span class="token operator">=</span> test_t2-test_t1<span class="token punctuation">;</span></code></pre></div>
<p>The less than symbols mean that the change is in the file in the first parameter (test<em>timer.c).  The greater than symbol indicates that the change is in the file in the second parameter (../1</em>timer/test<em>timer.c).  You should also notice three dashes (---) between the two lines indicating time</em>spent.  The 30,35d29 means that the lines were added after line 29 as lines 30-35.  The 42c36 means that line 42 in test<em>timer.c was compared with line 36 in ../1</em>timer/test_timer.c.</p>
<p>As shown above, there are two changes.  The first times everything but reverse_string.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">  <span class="token keyword">long</span> copy_t1 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">long</span> copy_t2 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The second change subtracts the time spent doing everything but the reverse string from the reverse string loop.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> time_spent <span class="token operator">=</span> <span class="token punctuation">(</span>test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>copy_t2<span class="token operator">-</span>copy_t1<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<h2 id="doing-a-better-job-of-timing-continued"><a href="#doing-a-better-job-of-timing-continued" aria-label="doing a better job of timing continued permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Doing a better job of timing continued</h2>
<p>In the last section, we eliminated the cost of the strcpy and loop from the timing.  Another thing to do is to reconsider our reverse<em>string function.  The reverse</em>string calls strlen to get the length of the string s.  We could try and just pass the length of s into the call.  We can get the length of the argument outside of the repeated and timed test.  For completeness, we will compare the timing of 2<em>timer with 3</em>timer.</p>
<p>The timing for the work in <i>illustrations/2<em>timing/2</em>timer</i> was...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">37</span>.4880ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">12</span>.5070ns
overall time_spent: <span class="token number">49</span>.9950ns</code></pre></div>
<p>This section's code is found in <i>illustrations/2<em>timing/3</em>timer</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">28</span>.8140ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">6</span>.5320ns
overall time_spent: <span class="token number">35</span>.3460ns</code></pre></div>
<p>Running make yields a 14.5 nanosecond improvement.  The difference between 2<em>timer and 3</em>timer can be found by running...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> test_timer.c <span class="token punctuation">..</span>/2_timer/test_timer.c
7c7,8
<span class="token operator">&lt;</span> void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
---
<span class="token operator">></span> void reverse_string<span class="token punctuation">(</span> char *s <span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">></span>   size_t len <span class="token operator">=</span> strlen<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token number">28</span>,30c29
<span class="token operator">&lt;</span>     size_t len <span class="token operator">=</span> strlen<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>     char *s <span class="token operator">=</span> <span class="token punctuation">(</span>char *<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>len+1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&lt;</span>
---
<span class="token operator">></span>     char *s <span class="token operator">=</span> <span class="token punctuation">(</span>char *<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>strlen<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>+1<span class="token punctuation">)</span><span class="token punctuation">;</span>
40c39
<span class="token operator">&lt;</span>       reverse_string<span class="token punctuation">(</span>s, len<span class="token punctuation">)</span><span class="token punctuation">;</span>
---
<span class="token operator">></span>       reverse_string<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Line 7 replaces lines 7-8 in the previous test_timer.c.  Lines 28-30 replace line 29.  Line 40 replaces line 39.</p>
<p>Lines 7-8</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>are replaced with this line at line 7</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<p>Instead of getting the string length of s in every call, reverse_string now expects the length of the string to be passed into it.</p>
<p>Line 29</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>is replaced with lines 28-30</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>We get the length of the ith argument one time before calling malloc and use that length in the malloc call.</p>
<p>Line 39</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>is replaced by line 40</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The length is passed into the reverse<em>string call so that reverse</em>string doesn't have to calculate it.  This optimization yielded another 14.5 nanoseconds.</p>
<h2 id="compiler-optimizations"><a href="#compiler-optimizations" aria-label="compiler optimizations permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Compiler optimizations</h2>
<p>It's important not to forget that the compiler can optimize the code further.  You can pass a flag called -O3 to gcc and sometimes see an improvement.</p>
<p>The timing for the work in <i>illustrations/2<em>timing/3</em>timer</i> was...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">28</span>.8140ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">6</span>.5320ns
overall time_spent: <span class="token number">35</span>.3460ns</code></pre></div>
<p>This section's code is found in <i>illustrations/2<em>timing/4</em>timer</i></p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">9</span>.7730ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">2</span>.5150ns
overall time_spent: <span class="token number">12</span>.2880ns</code></pre></div>
<p>Running make yields a 23 nanosecond improvement!  The only difference is in the Makefile.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> <span class="token builtin class-name">.</span> <span class="token punctuation">..</span>/3_timer/
<span class="token function">diff</span> ./Makefile <span class="token punctuation">..</span>/3_timer/Makefile
4c4
<span class="token operator">&lt;</span> 	gcc -O3 test_timer.c -o test_timer
---
<span class="token operator">></span> 	gcc test_timer.c -o test_timer</code></pre></div>
<p>The -O3 optimization (full optimization) was turned on in gcc.  It is good actually to compare time with optimizations turned on because sometimes the fastest code is slower once optimizations are turned on.</p>
<h1 id="splitting-up-code-into-multiple-files"><a href="#splitting-up-code-into-multiple-files" aria-label="splitting up code into multiple files permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Splitting up code into multiple files</h1>
<p>This section's code is found in <i>illustrations/2<em>timing/5</em>timer</i></p>
<p>If you run diff -q . ../4_timer/, a brief summary of what changed will be displayed.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> -q <span class="token builtin class-name">.</span> <span class="token punctuation">..</span>/4_timer/
Files ./Makefile and <span class="token punctuation">..</span>/4_timer/Makefile differ
Only <span class="token keyword">in</span> .: file2.c
Files ./test_timer.c and <span class="token punctuation">..</span>/4_timer/test_timer.c differ</code></pre></div>
<p>In the test_timer.c, there were two functions besides the main function.  To illustrate how you can break your code up into multiple files, I moved those functions to file2.c</p>
<p>file2.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>e <span class="token operator">=</span> s<span class="token operator">+</span>len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>s <span class="token operator">&lt;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>
    <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
    <span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    s<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">long</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The next change is to include file2.c in test_timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>The compiler inserts the contents of file2.c into test_timer.c.  At this point, if there was another source file that wanted to use these functions, all they would have to do is #include "file2.c".  For example:</p>
<p>test_reverse.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">strdup</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string duplicate</span>
    <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ gcc test_reverse.c -o test_reverse
In <span class="token function">file</span> included from test_reverse.c:1:
./file2.c:1:31: error: unknown <span class="token builtin class-name">type</span> name <span class="token string">'size_t'</span>
void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                              ^
./file2.c:13:18: error: variable has incomplete <span class="token builtin class-name">type</span> <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
                 ^
./file2.c:13:10: note: forward declaration of <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
         ^
./file2.c:14:3: warning: implicit declaration of <span class="token keyword">function</span> <span class="token string">'gettimeofday'</span> is invalid <span class="token keyword">in</span> C99 <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
  gettimeofday<span class="token punctuation">(</span><span class="token operator">&amp;</span>tv, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ^
./file2.c:14:21: error: use of undeclared identifier <span class="token string">'NULL'</span>
  gettimeofday<span class="token punctuation">(</span><span class="token operator">&amp;</span>tv, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ^
test_reverse.c:8:15: warning: implicitly declaring library <span class="token keyword">function</span> <span class="token string">'strdup'</span> with <span class="token builtin class-name">type</span> <span class="token string">'char *(const char *)'</span> <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    char *s <span class="token operator">=</span> strdup<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // string duplicate
              ^
test_reverse.c:8:15: note: include the header <span class="token operator">&lt;</span>string.h<span class="token operator">></span> or explicitly provide a declaration <span class="token keyword">for</span> <span class="token string">'strdup'</span>
<span class="token number">2</span> warnings and <span class="token number">3</span> errors generated.</code></pre></div>
<p>As you can see, there are lots of errors.  It's generally best to work through errors starting from the first one, and working down as the first error may cause other errors to occur.</p>
<p>The first error is</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">In file included from test_reverse.c:1:
./file2.c:1:31: error: unknown type name &#39;size_t&#39;
void reverse_string( char *s, size_t len ) {</code></pre></div>
<p>The error indicates that the type size<em>t is not known.  Use your favorite search engine and query "error: unknown type name 'size</em>t'".  You should be able to find that it is defined in stdio.h, so the solution is to include stdio.h.  Notice that we do include stdio.h in test_reverse.c, but it is after we include file2.c.  Ideally, file2.c would be complete, so let's modify file2.c to include stdio.h and rerun gcc.  You will have to add the following line to the beginning of file2.c.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span></code></pre></div>
<p>and then run gcc again.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ gcc test_reverse.c -o test_reverse
In <span class="token function">file</span> included from test_reverse.c:1:
./file2.c:15:18: error: variable has incomplete <span class="token builtin class-name">type</span> <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
                 ^
./file2.c:15:10: note: forward declaration of <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
         ^
./file2.c:16:3: warning: implicit declaration of <span class="token keyword">function</span> <span class="token string">'gettimeofday'</span> is invalid <span class="token keyword">in</span> C99 <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
  gettimeofday<span class="token punctuation">(</span><span class="token operator">&amp;</span>tv, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ^
test_reverse.c:8:15: warning: implicitly declaring library <span class="token keyword">function</span> <span class="token string">'strdup'</span> with <span class="token builtin class-name">type</span> <span class="token string">'char *(const char *)'</span> <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    char *s <span class="token operator">=</span> strdup<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // string duplicate
              ^
test_reverse.c:8:15: note: include the header <span class="token operator">&lt;</span>string.h<span class="token operator">></span> or explicitly provide a declaration <span class="token keyword">for</span> <span class="token string">'strdup'</span>
test_reverse.c:9:21: error: too few arguments to <span class="token keyword">function</span> call, expected <span class="token number">2</span>, have <span class="token number">1</span>
    reverse_string<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ~~~~~~~~~~~~~~  ^
./file2.c:3:1: note: <span class="token string">'reverse_string'</span> declared here
void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
^
<span class="token number">2</span> warnings and <span class="token number">2</span> errors generated.</code></pre></div>
<p>The following two errors are missing now...</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">In file included from test_reverse.c:1:
./file2.c:1:31: error: unknown type name &#39;size_t&#39;
void reverse_string( char *s, size_t len ) {

./file2.c:14:21: error: use of undeclared identifier &#39;NULL&#39;
  gettimeofday(&amp;tv, NULL);</code></pre></div>
<p>NULL was also defined in stdio.h, so by fixing the first error, we fixed another error.  This is a big reason that I fix errors from the beginning to the end. Often the fixes, fix other problems.</p>
<p>The next error is</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">In file included from test_reverse<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">1</span><span class="token operator">:</span>
<span class="token punctuation">.</span><span class="token operator">/</span>file2<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">15</span><span class="token operator">:</span><span class="token number">18</span><span class="token operator">:</span> error<span class="token operator">:</span> variable has incomplete type <span class="token string">'struct timeval'</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span></code></pre></div>
<p>Again, use your favorite search engine and query "error: variable has incomplete type 'struct timeval'".  I found the answer was to #include &#x3C;sys/time.h> on stack overflow.  Again, let's add this to file2.c right after the #include &#x3C;stdio.h> call.</p>
<p>Add this right after #include &#x3C;stdio.h> to file2.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span></code></pre></div>
<p>Again, run gcc to check for more errors</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ gcc test_reverse.c -o test_reverse
test_reverse.c:8:15: warning: implicitly declaring library <span class="token keyword">function</span> <span class="token string">'strdup'</span> with <span class="token builtin class-name">type</span> <span class="token string">'char *(const char *)'</span> <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
    char *s <span class="token operator">=</span> strdup<span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> // string duplicate
              ^
test_reverse.c:8:15: note: include the header <span class="token operator">&lt;</span>string.h<span class="token operator">></span> or explicitly provide a declaration <span class="token keyword">for</span> <span class="token string">'strdup'</span>
test_reverse.c:9:21: error: too few arguments to <span class="token keyword">function</span> call, expected <span class="token number">2</span>, have <span class="token number">1</span>
    reverse_string<span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ~~~~~~~~~~~~~~  ^
./file2.c:4:1: note: <span class="token string">'reverse_string'</span> declared here
void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
^
<span class="token number">1</span> warning and <span class="token number">1</span> error generated.</code></pre></div>
<p>Again, by fixing the one error, we fixed more.  Let's continue with the next warning.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">test_reverse.c:8:15: warning: implicitly declaring library function &#39;strdup&#39; with type &#39;char *(const char *)&#39; [-Wimplicit-function-declaration]
    char *s = strdup(argv[i]); // string duplicate
              ^
test_reverse.c:8:15: note: include the header &lt;string.h&gt; or explicitly provide a declaration for &#39;strdup&#39;</code></pre></div>
<p>Notice that this time, gcc actually gives us a hint (include the header &#x3C;string.h>).  Let's add this to test_reverse.c</p>
<p>test_reverse.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">strdup</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string duplicate</span>
    <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>We don't have to recompile every time.  We can go ahead and look at the next error and try and fix more than one.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">test_reverse.c:9:21: error: too few arguments to function call, expected 2, have 1
    reverse_string(s);
    ~~~~~~~~~~~~~~  ^
./file2.c:4:1: note: &#39;reverse_string&#39; declared here
void reverse_string( char *s, size_t len ) {
^</code></pre></div>
<p>Again, gcc is helping us by pointing out that reverse_string requires two arguments and what they should be.  I forgot to pass the length of the string as the second argument.  We can do that with strlen.</p>
<p>test_reverse.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token function">strdup</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// string duplicate</span>
    <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token function">strlen</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now if you run gcc:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ gcc test_reverse.c -o test_reverse
$</code></pre></div>
<p>All of the errors and warnings are gone.  </p>
<p>We can run test_reverse like...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ ./test_reverse This is a <span class="token builtin class-name">test</span>
This <span class="token operator">=</span><span class="token operator">></span> sihT
is <span class="token operator">=</span><span class="token operator">></span> si
a <span class="token operator">=</span><span class="token operator">></span> a
<span class="token builtin class-name">test</span> <span class="token operator">=</span><span class="token operator">></span> tset</code></pre></div>
<p>If you were following along and changing file2.c, you can run make again to see if the changes work in the original test_timer.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">11</span>.9100ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">3</span>.1390ns
overall time_spent: <span class="token number">15</span>.0490ns</code></pre></div>
<p>The changes work.</p>
<p>Before continuing, you should note that there was one important change in Makefile</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">test_timer: test_timer.c</code></pre></div>
<p>changed to</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">test_timer: test_timer.c file2.c</code></pre></div>
<p>This change is helpful because it says that the test<em>timer block should run if any of the files have changed.  Now that test</em>timer is made up of two files, we should list both files.  Internally, make simply looks at the time stamp of test<em>timer and test</em>timer.c and file2.c.  If test<em>timer.c or file2.c has a timestamp that is greater than test</em>timer (or test_timer doesn't exist), then the block will be run again.</p>
<h2 id="splitting-up-your-code-into-multiple-files-part-2"><a href="#splitting-up-your-code-into-multiple-files-part-2" aria-label="splitting up your code into multiple files part 2 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Splitting up your code into multiple files part 2</h2>
<p>This section's code is found in <i>illustrations/2<em>timing/6</em>timer</i></p>
<p>It is generally a good idea to make each file or group of files self-contained.  In the last section, we didn't notice errors when running make, but we did when trying to build test<em>reverse.  The errors didn't occur because before including file2.c we had already included stdio.h and sys/time.h.  In general, you want to include your custom code first, as this will present the error earlier.  We should make the following change to test</em>timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span></code></pre></div>
<p>change to</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span></code></pre></div>
<p>If you go back and change test<em>timer.c in <i>illustrations/2</em>timing/5<em>timer</i> and then run make, you will get some of the same errors that we had when building test</em>reverse.</p>
<p>in illustrations/2<em>timing/5</em>timer after making above change</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 test_timer.c -o test_timer
In <span class="token function">file</span> included from test_timer.c:1:
./file2.c:1:31: error: unknown <span class="token builtin class-name">type</span> name <span class="token string">'size_t'</span>
void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
                              ^
./file2.c:13:18: error: variable has incomplete <span class="token builtin class-name">type</span> <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
                 ^
./file2.c:13:10: note: forward declaration of <span class="token string">'struct timeval'</span>
  struct timeval tv<span class="token punctuation">;</span>
         ^
./file2.c:14:3: warning: implicit declaration of <span class="token keyword">function</span> <span class="token string">'gettimeofday'</span> is invalid <span class="token keyword">in</span> C99 <span class="token punctuation">[</span>-Wimplicit-function-declaration<span class="token punctuation">]</span>
  gettimeofday<span class="token punctuation">(</span><span class="token operator">&amp;</span>tv, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
  ^
./file2.c:14:21: error: use of undeclared identifier <span class="token string">'NULL'</span>
  gettimeofday<span class="token punctuation">(</span><span class="token operator">&amp;</span>tv, NULL<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    ^
One warning and three errors generated.
make: *** <span class="token punctuation">[</span>test_timer<span class="token punctuation">]</span> Error <span class="token number">1</span></code></pre></div>
<p>If we make the change in <i>illustrations/2<em>timing/6</em>timer</i> and run make</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">7</span>.6000ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">1</span>.7670ns
overall time_spent: <span class="token number">9</span>.3670ns</code></pre></div>
<p>In this section, I also removed the following two lines from test<em>timer.c as test</em>timer.c doesn't directly call any time-related functions.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span></code></pre></div>
<p>It all works because we have fixed file2.c to have the right include statements.  Particularly if you are developing a new package, it is a good idea to include your packages before outside or system packages.</p>
<h2 id="separating-the-implementation-from-the-interface"><a href="#separating-the-implementation-from-the-interface" aria-label="separating the implementation from the interface permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Separating the implementation from the interface</h2>
<p>This section's code is found in <i>illustrations/2<em>timing/7</em>timer</i></p>
<p>The key to writing large software projects that work is to define objects and make them highly reusable clearly.  When defining objects, it is best to split the object into an interface and an implementation.  Ideally, the interface will only describe what the object does and not how it works.  </p>
<p>This is much like an automobile and a transmission.  An automobile might require a transmission with certain specifications.  That automobile doesn't care how the transmission is made.  An interface is like the specifications to a transmission.  The implementation would include how the transmission works.  C allows you to declare that a thing exists before it being defined.  Typically, this is done in header files (files that end in a .h extension), but it can be done anywhere.  In this section, we will show how to declare that the functions in file2.c without including them.</p>
<p>In test_timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.c"</span></span></code></pre></div>
<p>changes to</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Declaring the functions this way, lets the compiler know that the functions do exist.  The syntax is the same as writing the function, except you replace the {} with a semicolon.</p>
<p>If you run make...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 test_timer.c -o test_timer
Undefined symbols <span class="token keyword">for</span> architecture x86_64:
  <span class="token string">"_get_time"</span>, referenced from:
      _main <span class="token keyword">in</span> test_timer-276d5b.o
  <span class="token string">"_reverse_string"</span>, referenced from:
      _main <span class="token keyword">in</span> test_timer-276d5b.o
ld: symbol<span class="token punctuation">(</span>s<span class="token punctuation">)</span> not found <span class="token keyword">for</span> architecture x86_64</code></pre></div>
<p>This happens because we have defined the functions, but they ultimately don't make it into the binary.  To fix this, change the following line in Makefile.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">gcc -O3 test_timer.c -o test_timer</code></pre></div>
<p>to (add file2.c to the gcc line)</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">gcc -O3 file2.c test_timer.c -o test_timer</code></pre></div>
<p>Save and run make again</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 file2.c test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">8</span>.1540ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">2</span>.4490ns
overall time_spent: <span class="token number">10</span>.6030ns</code></pre></div>
<p>Everything works as expected.</p>
<h2 id="separating-the-implementation-from-the-interface-part-2"><a href="#separating-the-implementation-from-the-interface-part-2" aria-label="separating the implementation from the interface part 2 permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Separating the implementation from the interface (part 2)</h2>
<p>This section's code is found in <i>illustrations/2<em>timing/8</em>timer</i></p>
<p>Ideally, file2.c should have a corresponding file2.h that describes what exists in file2.c.  We can put the definition of get<em>time and reverse</em>string into file2.h as follows:</p>
<p>file2.h:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _file2_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _file2_H</span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>The #ifndef, #define, #endif block prevents the compiler from including the same code over and over again.  It checks to see if <em>file2</em>H has been defined and if it hasn't, it defines it.  If it has been defined previously, the compiler skips the block.</p>
<p>size<em>t is used in reverse</em>string, which is defined in stdlib.h, so we include stdlib.h.  One last change is to update file2.c to include file2.h so that we can be sure that file2.c and file2.h don't get out of sync.</p>
<p>file2.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>Now we can include file2.h in test<em>timer.c instead of defining the functions in test</em>timer.c.</p>
<p>test_timer.c changes from</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

<span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">long</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></code></pre></div>
<p>to</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"file2.h"</span></span></code></pre></div>
<p>Again, since this is something that is our own, we should include it before the system or third party includes.  The Makefile changed slightly.</p>
<p>Makefile changed from</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c file2.c</code></pre></div>
<p>to</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c file2.h file2.c</code></pre></div>
<p>So that test_timer will be built if file2.h is updated.</p>
<h2 id="defining-an-object"><a href="#defining-an-object" aria-label="defining an object permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Defining an object</h2>
<p>This section's code is found in <i>illustrations/2<em>timing/9</em>xxx</i></p>
<p>To build the code run...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 xxx.c test_xxx.c -o test_xxx
./test_xxx
Hello: <span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">2</span><span class="token punctuation">)</span></code></pre></div>
<p>The objects that will be created throughout the rest of this book will look something like this (where xxx is the object name):</p>
<p>xxx.h</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _xxx_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _xxx_H</span>

<span class="token keyword">struct</span> <span class="token class-name">xxx_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">xxx_s</span> xxx_t<span class="token punctuation">;</span>

xxx_t <span class="token operator">*</span> <span class="token function">xxx_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> param1<span class="token punctuation">,</span> <span class="token keyword">int</span> param2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">xxx_destroy</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">xxx_do_something</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>prefix <span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>The header file or interface simply provides what exists and doesn't offer details into how xxx might work.  The int param1, int param2, and const char *prefix above are just examples.  The init function often doesn't have any parameters.  The init function is used to create the structure so that the other functions can use it within the xxx object.  The destroy function destroys the xxx<em>t structure.  The xxx</em>t structure doesn't have members.  It is just declared (like the functions after it) so that the compiler knows that the structure is defined somewhere.  By defining the structure like this, applications using the xxx object cannot access members of the structure.  The implementation is free to put whatever members in the structure to make the function work.  The only thing applications which use this object are required to do is create (or init) the object and then pass it around to the various functions that use that type.  If there is a destroy method, then the application is expected to destroy the object to clean it up.</p>
<p>To use the above interface, you will include it and call its methods.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"xxx.h"</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xxx_t <span class="token operator">*</span>handle <span class="token operator">=</span> <span class="token function">xxx_init</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">xxx_do_something</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"Hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">xxx_destroy</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>xxx.h is just an interface.  The implementation of those functions would be in a C file.</p>
<p>xxx.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"xxx.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">xxx_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

xxx_t <span class="token operator">*</span> <span class="token function">xxx_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> param1<span class="token punctuation">,</span> <span class="token keyword">int</span> param2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xxx_t <span class="token operator">*</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>xxx_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>xxx_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>x <span class="token operator">=</span> param1<span class="token punctuation">;</span>
  h<span class="token operator">-></span>y <span class="token operator">=</span> param2<span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">xxx_destroy</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">xxx_do_something</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>prefix <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s: (%d, %d)\n"</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> h<span class="token operator">-></span>x<span class="token punctuation">,</span> h<span class="token operator">-></span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>One thing that hasn't been talked about much is the struct keyword.</p>
<p>In C, you can group multiple data types as variables to define a larger structure.  A classic example is to create a point structure.  Typically, they would be defined as follows:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">point</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">point</span> p<span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"(%d, %d)\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You can use typedef to reduce the need for typing the keyword struct over and over...</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">point_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span> point<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  point p<span class="token punctuation">;</span> <span class="token comment">// or struct point_s p;</span>
  p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"(%d, %d)\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>You can also define that a struct will exist and then define it later.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">point_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">point_s</span> point<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">point_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  point p<span class="token punctuation">;</span> <span class="token comment">// or struct point_s p;</span>
  p<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  p<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"(%d, %d)\n"</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span> p<span class="token punctuation">.</span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>To access members of a struct value, you use the dot notation.  If you have a pointer to the structure, then you access members using the -> syntax.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">point_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">point_s</span> point<span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">point_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  point p<span class="token punctuation">;</span> <span class="token comment">// or struct point_s p;</span>
  point <span class="token operator">*</span>ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>p<span class="token punctuation">;</span> <span class="token comment">// &amp;p gets the address of p (or returns a pointer to p).</span>
  ptr<span class="token operator">-></span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  ptr<span class="token operator">-></span>y <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"(%d, %d)\n"</span><span class="token punctuation">,</span> ptr<span class="token operator">-></span>x<span class="token punctuation">,</span> ptr<span class="token operator">-></span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>In the code above, the xxx<em>s is declared in xxx.h and then typedef'd to xxx</em>t.
xxx.h:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">xxx_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">xxx_s</span> xxx_t<span class="token punctuation">;</span></code></pre></div>
<p>The xxx_s struct is actually defined in xxx.c:</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">xxx_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> x<span class="token punctuation">;</span>
  <span class="token keyword">int</span> y<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>The xxx<em>init function creates the xxx</em>t structure, sets the members, and then returns the newly allocated structure.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">xxx_t <span class="token operator">*</span> <span class="token function">xxx_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> param1<span class="token punctuation">,</span> <span class="token keyword">int</span> param2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  xxx_t <span class="token operator">*</span>h <span class="token operator">=</span> <span class="token punctuation">(</span>xxx_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>xxx_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  h<span class="token operator">-></span>x <span class="token operator">=</span> param1<span class="token punctuation">;</span>
  h<span class="token operator">-></span>y <span class="token operator">=</span> param2<span class="token punctuation">;</span>
  <span class="token keyword">return</span> h<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The xxx<em>destroy function frees the memory that was allocated in xxx</em>init.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">xxx_destroy</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The xxx<em>do</em>something function prints x and y after printing the prefix which is passed into it.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">xxx_do_something</span><span class="token punctuation">(</span> xxx_t <span class="token operator">*</span>h<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>prefix <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"%s: (%d, %d)\n"</span><span class="token punctuation">,</span> prefix<span class="token punctuation">,</span> h<span class="token operator">-></span>x<span class="token punctuation">,</span> h<span class="token operator">-></span>y <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h2 id="the-timer-interface"><a href="#the-timer-interface" aria-label="the timer interface permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>The timer interface</h2>
<p>The following code is found in <i>illustrations/2<em>timing/10</em>timer</i></p>
<p>The Makefile has one minor difference.  This project will have a separate timer object.  The gcc command will run if test_timer.c, timer.c, or timer.h are changed.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c timer.c timer.h
	gcc -O3 timer.c test_timer.c -o test_timer</code></pre></div>
<p>Build the project...</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">make</span>
gcc -O3 timer.c test_timer.c -o test_timer
./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse
ABCDEFGHIJKLMNOPQRSTUVWXYZ <span class="token operator">=</span><span class="token operator">></span> ZYXWVUTSRQPONMLKJIHGFEDCBA
time_spent: <span class="token number">9</span>.7730ns
Reverse <span class="token operator">=</span><span class="token operator">></span> esreveR
time_spent: <span class="token number">2</span>.5150ns
overall time_spent: <span class="token number">12</span>.2880ns</code></pre></div>
<p>The timing is the same as 4_timer.  This section will be about</p>
<p>In test_timer.c the following lines of code exists.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span></code></pre></div>
<p>To make our project reusable, we need to break it up into objects (or interfaces and implementations).  In the above example, we are including timer.h (which we will make next).  </p>
<p>timer.h (comments removed)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _timer_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _timer_H</span>

<span class="token keyword">struct</span> <span class="token class-name">timer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer_s</span> timer_t<span class="token punctuation">;</span>

timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
timer_t <span class="token operator">*</span><span class="token function">timer_timer_init</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>Earlier, you learned that the struct keyword allows you to group zero or more types to form a new type.  In general, I like to name struct types with a <em>s suffix and then typedef them to have a _t suffix.  In the timer.h above, the timer</em>s struct was declared, but never actually defined.  The details of what is in the structure are part of the implementation and aren't meant to be known externally.  C allows you to define types in this way and use them as long as you only reference them as pointers.  All pointers have the same size (the number of bits that the CPU supports or the sizeof(size<em>t)).  For now, just recognize that there is a new type named timer</em>t and that timer_s will be defined in timer.c.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer_s</span> timer_t<span class="token punctuation">;</span></code></pre></div>
<p>I follow a pattern where every function is prefixed by the object name (in this case, timer).  The primary type (if there is one) is usually the object name followed by _t.  Objects will typically have an init, and a destroy method.  The job of the header file is to create an interface for applications to use.  It should hide the implementation details as much as possible.  I usually will define an interface before defining an implementation.</p>
<p>Initialize the timer.  repeat is necessary to indicate how many times the test will be repeated within the application so that the final result represents that.  If a thing is only being timed with a single repetition, then use a value of 1.  This function will allocate the timer<em>t structure and fill its members appropriately.  To free up the resources associated with this call, you must call timer</em>destroy with the return value of this call.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Initialize a timer from another timer.  This will subtract the time spent and set the repeat from the timer, which is passed as a parameter to timer<em>timer</em>init.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span><span class="token function">timer_timer_init</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Destroy the timer created from timer<em>init or timer</em>timer_init.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Subtract the amount of time spent in sub from the current timer (t)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Add the amount of time spent in add to the current timer (t)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Start the timer (t)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Stop the timer (t)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Returns time spent in nanoseconds (ns), microseconds (us), milliseconds (ms), and seconds (sec).</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>Notice that timer.h doesn't mention how it is going to be implemented in any way.  It simply names functions in a way that is useable and describes what they do.</p>
<p>I usually copy the .h (header file) to a similarly named .c (implementation file) and then fill in the details.</p>
<p>timer.c (incomplete)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">ifndef</span> _timer_H</span>
<span class="token macro property">#<span class="token directive keyword">define</span> _timer_H</span>

<span class="token keyword">struct</span> <span class="token class-name">timer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer_s</span> timer_t<span class="token punctuation">;</span>

timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
timer_t <span class="token operator">*</span><span class="token function">timer_timer_init</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property">#<span class="token directive keyword">endif</span></span></code></pre></div>
<p>The first thing to do is to remove the #ifndef/#define/#endif and replace it with an #include "timer.h".</p>
<p>timer.c (incomplete)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span>

<span class="token keyword">struct</span> <span class="token class-name">timer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer_s</span> timer_t<span class="token punctuation">;</span>

timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_set_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> <span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The next thing to do is to fill in the timer_s details and remove the typedef that follows.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timer_s</span><span class="token punctuation">;</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer_s</span> timer_t<span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">struct</span> <span class="token class-name">timer_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> base<span class="token punctuation">;</span>
  <span class="token keyword">int</span> repeat<span class="token punctuation">;</span>
  <span class="token keyword">long</span> time_spent<span class="token punctuation">;</span>
  <span class="token keyword">long</span> start_time<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div>
<p>repeat is the number of times that the test will be repeated.  time<em>spent is the total time that has been spent within this object so far.  start</em>time is recorded every time timer_start is called.  base is used to track how much time should be added or subtracted from the final time spent based upon other timers.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  timer_t <span class="token operator">*</span>t <span class="token operator">=</span> <span class="token punctuation">(</span>timer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>timer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  t<span class="token operator">-></span>repeat <span class="token operator">=</span> repeat<span class="token punctuation">;</span>
  t<span class="token operator">-></span>base <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">=</span> t<span class="token operator">-></span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<h1 id="include-stdlibh-is-added-at-the-top-of-the-file-since-it-is-needed-for-malloc--all-of-the-members-are-initialized-to-zero-except-repeat-which-is-set-to-the-value-passed-into-timer_init"><a href="#include-stdlibh-is-added-at-the-top-of-the-file-since-it-is-needed-for-malloc--all-of-the-members-are-initialized-to-zero-except-repeat-which-is-set-to-the-value-passed-into-timer_init" aria-label="include stdlibh is added at the top of the file since it is needed for malloc  all of the members are initialized to zero except repeat which is set to the value passed into timer_init permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>include &#x3C;stdlib.h> is added at the top of the file since it is needed for malloc.  All of the members are initialized to zero except repeat (which is set to the value passed into timer_init).</h1>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>timer_destroy simply needs to free the memory that was allocated by either of the init methods.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_set_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> <span class="token keyword">int</span> repeat<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">int</span> <span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> t<span class="token operator">-></span>repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_set_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> <span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>repeat <span class="token operator">=</span> repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Because the details of the timer_t structure are only known to timer.c, functions must be used to access members of the structure.  This encapsulation keeps a good separation from the interface and the implementation.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>base <span class="token operator">-=</span> <span class="token punctuation">(</span>sub<span class="token operator">-></span>time_spent<span class="token operator">+</span>sub<span class="token operator">-></span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>base <span class="token operator">+=</span> <span class="token punctuation">(</span>add<span class="token operator">-></span>time_spent<span class="token operator">+</span>add<span class="token operator">-></span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>These methods may also have been initialized from another timer, so the base is added to the time_spent.  </p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  t<span class="token operator">-></span>start_time <span class="token operator">=</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">long</span> v <span class="token operator">=</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
  v <span class="token operator">-=</span> t<span class="token operator">-></span>start_time<span class="token punctuation">;</span>
  t<span class="token operator">-></span>time_spent <span class="token operator">+=</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>timer<em>start is basically the same as get</em>time() defined earlier.  The difference is that it sets the start<em>time member of the struct timer</em>t t.</p>
<p>Finally, the following functions are changed to.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>to</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>ts<span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> <span class="token punctuation">(</span>r<span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> <span class="token punctuation">(</span>r<span class="token operator">*</span><span class="token number">1000000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The member time_spent and base are in microseconds.  Each function above does the appropriate conversions.</p>
<p>timer.c (the finished product)</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;time.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>

<span class="token keyword">struct</span> <span class="token class-name">timer_s</span> <span class="token punctuation">{</span>
  <span class="token keyword">long</span> base<span class="token punctuation">;</span>
  <span class="token keyword">int</span> repeat<span class="token punctuation">;</span>
  <span class="token keyword">long</span> time_spent<span class="token punctuation">;</span>
  <span class="token keyword">long</span> start_time<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

timer_t <span class="token operator">*</span><span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  timer_t <span class="token operator">*</span>t <span class="token operator">=</span> <span class="token punctuation">(</span>timer_t <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>timer_t<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  t<span class="token operator">-></span>repeat <span class="token operator">=</span> repeat<span class="token punctuation">;</span>
  t<span class="token operator">-></span>base <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">=</span> t<span class="token operator">-></span>start_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> t<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_destroy</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">free</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* get the number of times a task is meant to repeat */</span>
<span class="token keyword">int</span> <span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> t<span class="token operator">-></span>repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* set the number of times a task is meant to repeat */</span>
<span class="token keyword">void</span> <span class="token function">timer_set_repeat</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> <span class="token keyword">int</span> repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>repeat <span class="token operator">=</span> repeat<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">timer_subtract</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>sub<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>base <span class="token operator">-=</span> <span class="token punctuation">(</span>sub<span class="token operator">-></span>time_spent<span class="token operator">+</span>sub<span class="token operator">-></span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_add</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">,</span> timer_t <span class="token operator">*</span>add<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  t<span class="token operator">-></span>base <span class="token operator">+=</span> <span class="token punctuation">(</span>add<span class="token operator">-></span>time_spent<span class="token operator">+</span>add<span class="token operator">-></span>base<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_start</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  t<span class="token operator">-></span>start_time <span class="token operator">=</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">timer_stop</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
  <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">long</span> v <span class="token operator">=</span> <span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec <span class="token operator">*</span> <span class="token number">1000000</span><span class="token punctuation">)</span> <span class="token operator">+</span> tv<span class="token punctuation">.</span>tv_usec<span class="token punctuation">;</span>
  v <span class="token operator">-=</span> t<span class="token operator">-></span>start_time<span class="token punctuation">;</span>
  t<span class="token operator">-></span>time_spent <span class="token operator">+=</span> v<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>ts<span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span> <span class="token operator">/</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_us</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> r<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_ms</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> <span class="token punctuation">(</span>r<span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">double</span> <span class="token function">timer_sec</span><span class="token punctuation">(</span>timer_t <span class="token operator">*</span>t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">double</span> r <span class="token operator">=</span> t<span class="token operator">-></span>repeat <span class="token operator">*</span> <span class="token number">1.0</span><span class="token punctuation">;</span>
  <span class="token keyword">double</span> ts <span class="token operator">=</span> t<span class="token operator">-></span>time_spent <span class="token operator">+</span> t<span class="token operator">-></span>base<span class="token punctuation">;</span>
  <span class="token keyword">return</span> ts <span class="token operator">/</span> <span class="token punctuation">(</span>r<span class="token operator">*</span><span class="token number">1000000.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>Now that the timer interface has been defined, we can use it in our test_timer.c code.</p>
<p>test_timer.c</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span>

<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string.h></span></span>

<span class="token keyword">void</span> <span class="token function">reverse_string</span><span class="token punctuation">(</span> <span class="token keyword">char</span> <span class="token operator">*</span>s<span class="token punctuation">,</span> size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>e <span class="token operator">=</span> s<span class="token operator">+</span>len<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">while</span><span class="token punctuation">(</span>s <span class="token operator">&lt;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">char</span> tmp <span class="token operator">=</span> <span class="token operator">*</span>s<span class="token punctuation">;</span>
    <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token operator">*</span>e<span class="token punctuation">;</span>
    <span class="token operator">*</span>e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    s<span class="token operator">++</span><span class="token punctuation">;</span>
    e<span class="token operator">--</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span> <span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span>argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">int</span> repeat_test <span class="token operator">=</span> <span class="token number">1000000</span><span class="token punctuation">;</span>
  timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    timer_t <span class="token operator">*</span>test_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timer_start</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">timer_stop</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timer_subtract</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">,</span> copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timer_add</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">,</span> test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s => %s\n"</span><span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">timer_destroy</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">timer_destroy</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"overall time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_destroy</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre></div>
<p>The beginning should look familiar</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#include "timer.h"</span>

<span class="token comment">#include &lt;stdio.h></span>
<span class="token comment">#include &lt;stdlib.h></span>
<span class="token comment">#include &lt;string.h></span>

void reverse_string<span class="token punctuation">(</span> char *s, size_t len <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  char *e <span class="token operator">=</span> s+len-1<span class="token punctuation">;</span>
  while<span class="token punctuation">(</span>s <span class="token operator">&lt;</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    char tmp <span class="token operator">=</span> *s<span class="token punctuation">;</span>
    *s <span class="token operator">=</span> *e<span class="token punctuation">;</span>
    *e <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
    s++<span class="token punctuation">;</span>
    e--<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

int main<span class="token punctuation">(</span> int argc, char *argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></code></pre></div>
<p>We include the interface (or header file) we just created in the first line.  The rest of the code above has already been discussed.  </p>
<p>Considering what the code looked like before using the timer object offers insight into understanding the code.</p>
<p>Consider the following code from <i>illustrations/2<em>timing/8</em>timer</i></p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> overall_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">long</span> copy_t1 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">long</span> copy_t2 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>vs</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>argc<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  size_t len <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>s <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span>len<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>First, it is important to recognize that the new code is longer.  The number of lines of code isn't always a good measure to decide to create an object.  In the case of the timer object, the get_time() function is hidden in the timer object.  </p>
<p>Instead of just having a counter for the overall time, I've replaced it with a timer object named overall_timer.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> overall_time <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>In order to measure the time to copy, we will need a copy timer and start and stop it.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> copy_t1 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">long</span> copy_t2 <span class="token operator">=</span> <span class="token function">get_time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">timer_start</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">timer_stop</span><span class="token punctuation">(</span>copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The timer<em>init call gets the repeat</em>test variable from the overall<em>timer since they should all be the same.  The timer</em>init call could have just been</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>copy_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>but that would require that the repeat<em>test variable be separate.  This becomes important in more complex timings, but for now, I'm primarily showing how timer</em>get<em>repeat can be useful.  In C, parameters to functions can be the result of other functions.  The timer</em>get<em>repeat call would be resolved before calling timer</em>init.</p>
<p>To find the time spent in the first example, you need to subtract copy<em>t1 from copy</em>t2 and then divide that by the repeat factor.  This will return the number of microseconds that elapsed.  The timer<em>us(copy</em>timer) would yield the same result.  With the timer object, it is easy to get the time spent in microseconds, but also nanoseconds, milliseconds, and seconds.  Also, the timer object automatically converts the time spent to a double (a decimal).</p>
<p>The next section of code times the test (the reverse call) in the same way that the copy timer worked.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>test_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span><span class="token function">timer_get_repeat</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">timer_start</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span> <span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> j<span class="token operator">&lt;</span>repeat_test<span class="token punctuation">;</span> j<span class="token operator">++</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">strcpy</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> argv<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">reverse_string</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">timer_stop</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>The next two lines begin to show additional usefulness of the timer object.  The copy<em>timer is subtracted from the test</em>timer and then the test<em>timer is added to the overall</em>timer.  </p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">timer_subtract</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">,</span> copy_timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">timer_add</span><span class="token punctuation">(</span>overall_timer<span class="token punctuation">,</span> test_timer<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>I think this is easier to read than</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token keyword">long</span> time_spent <span class="token operator">=</span> <span class="token punctuation">(</span>test_t2<span class="token operator">-</span>test_t1<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token punctuation">(</span>copy_t2<span class="token operator">-</span>copy_t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
overall_time <span class="token operator">+=</span> time_spent<span class="token punctuation">;</span></code></pre></div>
<p>The timer objects also reduce the number of variables that are maintained in the code (each timer object replaces a t2 and t1 variable).</p>
<p>Finally, the following line</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>time_spent<span class="token operator">*</span><span class="token number">1000.0</span><span class="token punctuation">)</span><span class="token operator">/</span><span class="token punctuation">(</span>repeat_test<span class="token operator">*</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>is replaced with</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token function">printf</span><span class="token punctuation">(</span> <span class="token string">"time_spent: %0.4fns\n"</span><span class="token punctuation">,</span> <span class="token function">timer_ns</span><span class="token punctuation">(</span>test_timer<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>which again reduces complexity.  It is also easy to switch from nanoseconds to another measure if desired.</p>
<h2 id="making-the-timer-object-reusable"><a href="#making-the-timer-object-reusable" aria-label="making the timer object reusable permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Making the timer object reusable</h2>
<p>The following code is found in <i>illustrations/2<em>timing/11</em>timer</i></p>
<p>This timer object is done and is ready to be reused.  In C, all of your functions share the same namespace.  If another project has a function named timer_init, there will be a conflict.  Projects typically adopt a package prefix in addition to the object prefix to prevent conflicts.  For this project, we will use ac (another c library).</p>
<p>My rules for adding the prefix are:</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">1.  Comments should refer to the object name only.
2.  All code references should be prefixed.
3.  Functions should only use a prefix once even if multiple objects are
    referenced in the name</code></pre></div>
<p>The first thing to do is to copy timer.h to ac<em>timer.h and then apply the rules mentioned above.  The ac</em>timer header file exists in the current directory. What follows is a partial diff.</p>
<div class="gatsby-highlight" data-language="text"><pre class="language-text"><code class="language-text">$ diff timer.h ac_timer.h
1,2c1,2
&lt; #ifndef _timer_H
&lt; #define _timer_H
---
&gt; #ifndef _ac_timer_H
&gt; #define _ac_timer_H
4,5c4,5
&lt; struct timer_s;
&lt; typedef struct timer_s timer_t;
---
&gt; struct ac_timer_s;
&gt; typedef struct ac_timer_s ac_timer_t;
12c12
&lt; timer_t *timer_init(int repeat);
---
&gt; ac_timer_t *ac_timer_init(int repeat);
...</code></pre></div>
<p>The same thing is done for timer.c (copy to ac_timer.c and apply rules).</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> timer.c ac_timer.c
1c1
<span class="token operator">&lt;</span> <span class="token comment">#include "timer.h"</span>
---
<span class="token operator">></span> <span class="token comment">#include "ac_timer.h"</span>
7c7
<span class="token operator">&lt;</span> struct timer_s <span class="token punctuation">{</span>
---
<span class="token operator">></span> struct ac_timer_s <span class="token punctuation">{</span>
<span class="token number">14</span>,15c14,15
<span class="token operator">&lt;</span> timer_t *timer_init<span class="token punctuation">(</span>int repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">&lt;</span>   timer_t *t <span class="token operator">=</span> <span class="token punctuation">(</span>timer_t *<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>sizeof<span class="token punctuation">(</span>timer_t<span class="token punctuation">))</span><span class="token punctuation">;</span>
---
<span class="token operator">></span> ac_timer_t *ac_timer_init<span class="token punctuation">(</span>int repeat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token operator">></span>   ac_timer_t *t <span class="token operator">=</span> <span class="token punctuation">(</span>ac_timer_t *<span class="token punctuation">)</span>malloc<span class="token punctuation">(</span>sizeof<span class="token punctuation">(</span>ac_timer_t<span class="token punctuation">))</span><span class="token punctuation">;</span>
21c21
<span class="token punctuation">..</span>.</code></pre></div>
<p>Finally, test<em>timer.c needs to change to use ac</em>timer instead of timer.</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"ac_timer.h"</span></span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"timer.h"</span></span></code></pre></div>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>becomes</p>
<div class="gatsby-highlight" data-language="c"><pre class="language-c"><code class="language-c">ac_timer_t <span class="token operator">*</span>overall_timer <span class="token operator">=</span> <span class="token function">ac_timer_init</span><span class="token punctuation">(</span>repeat_test<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div>
<p>and so on.</p>
<h2 id="splitting-up-a-project-into-multiple-directories"><a href="#splitting-up-a-project-into-multiple-directories" aria-label="splitting up a project into multiple directories permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Splitting up a project into multiple directories</h2>
<ul>
<li>Moving ac_timer to src (and variables in Makefile)</li>
</ul>
<p>The following code is found in <i>illustrations/2<em>timing/12</em>timer</i></p>
<p>Once the object has the ac prefix, we can move it to the src directory.  This is done by executing the following command - this actually won't work as it already has been moved.</p>
<p>This command will not work because it was done for you.</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token function">mv</span> ac_timer.h ac_timer.c <span class="token variable">$ac</span>/src</code></pre></div>
<p>You can see that the files exist by running</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/src
<span class="token function">ls</span> -l ac_timer.*</code></pre></div>
<p>which will output</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">-rw-r--r--  <span class="token number">1</span> ac  staff  <span class="token number">1777</span> Sep <span class="token number">11</span> <span class="token number">12</span>:12 ac_timer.c
-rw-r--r--  <span class="token number">1</span> ac  staff  <span class="token number">1314</span> Sep <span class="token number">11</span> <span class="token number">12</span>:12 ac_timer.h</code></pre></div>
<p>You can change back to the previous directory (illustrations/2<em>timing/12</em>timer) by running</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> -</code></pre></div>
<p>or</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">cd</span> <span class="token variable">$ac</span>/illustrations/2_timing/12_timer</code></pre></div>
<p>cd - allows you to change to the directory that you were in previously and is useful.</p>
<p>Ensuring the program builds properly requires a few changes to Makefile. The diff looks like the following:</p>
<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">$ <span class="token function">diff</span> Makefile <span class="token punctuation">..</span>/11_timer/Makefile
<span class="token number">1</span>,5d0
<span class="token operator">&lt;</span> <span class="token assign-left variable">ROOT</span><span class="token operator">=</span><span class="token punctuation">..</span>/<span class="token punctuation">..</span>/<span class="token punctuation">..</span>
<span class="token operator">&lt;</span> <span class="token assign-left variable">OBJECTS</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>ROOT<span class="token variable">)</span></span>/src/ac_timer.c
<span class="token operator">&lt;</span> <span class="token assign-left variable">HEADER_FILES</span><span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span>ROOT<span class="token variable">)</span></span>/src/ac_timer.h
<span class="token operator">&lt;</span> <span class="token assign-left variable">FLAGS</span><span class="token operator">=</span>-O3 -I<span class="token variable"><span class="token variable">$(</span>ROOT<span class="token variable">)</span></span>/src
<span class="token operator">&lt;</span>
<span class="token number">8</span>,9c3,4
<span class="token operator">&lt;</span> test_timer: test_timer.c <span class="token variable"><span class="token variable">$(</span>OBJECTS<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>HEADER_FILES<span class="token variable">)</span></span>
<span class="token operator">&lt;</span> 	gcc <span class="token variable"><span class="token variable">$(</span>FLAGS<span class="token variable">)</span></span> <span class="token variable"><span class="token variable">$(</span>OBJECTS<span class="token variable">)</span></span> test_timer.c -o test_timer
---
<span class="token operator">></span> test_timer: test_timer.c ac_timer.c ac_timer.h
<span class="token operator">></span> 	gcc -O3 ac_timer.c test_timer.c -o test_timer</code></pre></div>
<p>A new section of variables are added at the top and the test_timer target use those variables.</p>
<p>The Makefile for this project.</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">ROOT<span class="token operator">=</span>../../..
OBJECTS<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_timer.c
HEADER_FILES<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_timer.h
FLAGS<span class="token operator">=</span>-O3 -I<span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src

<span class="token symbol">all</span><span class="token punctuation">:</span> test_timer examples

<span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c <span class="token variable">$</span><span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>HEADER_FILES<span class="token punctuation">)</span>
	gcc <span class="token variable">$</span><span class="token punctuation">(</span>FLAGS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> test_timer.c -o test_timer

<span class="token symbol">examples</span><span class="token punctuation">:</span>
	./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse

<span class="token symbol">clean</span><span class="token punctuation">:</span>
	rm -f test_timer *~</code></pre></div>
<p>make allows you to create variables using the <name>=<value> syntax outside of sections.  You can then reference the value of those variables by enclosing the name in $(<name>).  One variable can reference another variable (see OBJECTS and ROOT above).  For gcc to find the ac_timer.h file, the src path needs to be added to gcc's include path.  That is done by using the -I<directory> option.  If you have multiple include paths, you can specify -I<directory> multiple times.  </p>
<h2 id="splitting-up-the-makefile"><a href="#splitting-up-the-makefile" aria-label="splitting up the makefile permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Splitting up the Makefile</h2>
<p>The following code is found in <i>illustrations/2<em>timing/13</em>timer</i></p>
<p>Ideally, the objects in src could be defined by a Makefile in src, and that Makefile could be included.  In src, there is a file named Makefile.include, which defines the variables that were in the Makefile in the last section (as well as for other objects in src).</p>
<p>Makefile.include in src</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">OBJECTS<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_timer.c <span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_buffer.c <span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_pool.c
HEADER_FILES<span class="token operator">=</span><span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_timer.h <span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_buffer.h <span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/ac_pool.h
FLAGS<span class="token operator">=</span>-O3 -I<span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src</code></pre></div>
<p>Makefile in illustrations/2<em>timing/13</em>timer</p>
<div class="gatsby-highlight" data-language="makefile"><pre class="language-makefile"><code class="language-makefile">ROOT<span class="token operator">=</span>../../..
<span class="token keyword">include</span> <span class="token variable">$</span><span class="token punctuation">(</span>ROOT<span class="token punctuation">)</span>/src/Makefile.<span class="token keyword">include</span>

<span class="token symbol">all</span><span class="token punctuation">:</span> test_timer examples

<span class="token symbol">test_timer</span><span class="token punctuation">:</span> test_timer.c <span class="token variable">$</span><span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>HEADER_FILES<span class="token punctuation">)</span>
	gcc <span class="token variable">$</span><span class="token punctuation">(</span>FLAGS<span class="token punctuation">)</span> <span class="token variable">$</span><span class="token punctuation">(</span>OBJECTS<span class="token punctuation">)</span> test_timer.c -o test_timer

<span class="token symbol">examples</span><span class="token punctuation">:</span>
	./test_timer ABCDEFGHIJKLMNOPQRSTUVWXYZ Reverse

<span class="token symbol">clean</span><span class="token punctuation">:</span>
	rm -f test_timer *~</code></pre></div>
<p>The difference is that instead of the OBJECTS, HEADER_FILES, and FLAGS variables being specified in the Makefile, they are included by including $(ROOT)/src/Makefile.include.</p>
<h1 id="the-buffer-object"><a href="#the-buffer-object" aria-label="the buffer object permalink" class="anchor"><svg aria-hidden="true" focusable="false" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><a href="3_buffer.md">The Buffer Object</a></h1>
<p><a href="../README.md">Table of Contents</a>  - Copyright 2019 Andy Curtis</p></div></div><div style="font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif;width:400px;height:100vh;padding:15px;color:#1E4E8C;position:sticky;top:62px;border-left:solid 1px #EDF2F7" class="Sidebar"><div><div><a href="/ebook/1-getting-started">1. Getting Started</a></div><div><a href="/ebook/2-timing">2. Timing Your Code</a></div><div><a href="/ebook/3-buffer">3. The Buffer Object</a></div><div><a href="/ebook/4-linked-lists">4. Linked Lists</a></div><div><a href="/ebook/5-threads">5. Introducing Threads</a></div><div><a href="/ebook/6-macros">6. Macros</a></div><div><a href="/ebook/7-allocator">7. The Global Allocator Object</a></div><div><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></div><div><a href="/ebook/9-pool">9. The Pool Object</a></div><div><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></div><div><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></div><div><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></div><div><a href="/ebook/13-map">13. The Map Object</a></div><div><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></div></div></div></div></main><footer style="background-color:#1A202C;padding:10px;color:white;font-family:-apple-system,&#x27;BlinkMacSystemFont&#x27;,&#x27;Segoe UI&#x27;,&#x27;Roboto&#x27;,&#x27;Oxygen&#x27;,&#x27;Ubuntu&#x27;,&#x27;Cantarell&#x27;,&#x27;Fira Sans&#x27;,&#x27;Droid Sans&#x27;,&#x27;Helvetica Neue&#x27;,sans-serif"><div class="Footer"><div><h1 style="margin:10px 0">Another C Library</h1><p style="margin-bottom:15px"> <!-- -->2019<!-- --> Andy Curtis &amp; Daniel Curtis</p><ul style="list-style:none;margin-left:0"><li><a style="color:#3182CE" href="/contact">Contact</a></li><li><a style="color:#3182CE" href="/contributing">Contributing</a></li><li><a style="color:#3182CE" href="/license">License</a></li></ul></div><div><h2 style="margin:10px auto">A C eBook</h2><ul style="list-style:none;margin-left:0"><li><a href="/ebook/1-getting-started">1. Getting Started</a></li><li><a href="/ebook/2-timing">2. Timing Your Code</a></li><li><a href="/ebook/3-buffer">3. The Buffer Object</a></li><li><a href="/ebook/4-linked-lists">4. Linked Lists</a></li><li><a href="/ebook/5-threads">5. Introducing Threads</a></li><li><a href="/ebook/6-macros">6. Macros</a></li><li><a href="/ebook/7-allocator">7. The Global Allocator Object</a></li><li><a href="/ebook/8-allocator-implementation">8. The Global Allocator Implementation</a></li><li><a href="/ebook/9-pool">9. The Pool Object</a></li><li><a href="/ebook/10-binary-search-trees">10. Binary Search Trees</a></li><li><a href="/ebook/11-balancing-binary-search-trees">11. Balancing Binary Search Trees</a></li><li><a href="/ebook/12-red-black-tree">12. The Red-Black Tree</a></li><li><a href="/ebook/13-map">13. The Map Object</a></li><li><a href="/ebook/14-set-and-multimap">14. The Set and Multimap</a></li></ul></div><div><h2 style="margin:10px auto">Resources</h2><ul style="list-style:none;margin-left:0"><li><a href="https://medium.com/software-design/why-software-developers-should-care-about-cpu-caches-8da04355bb8a" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Why software developers should care about CPU caches <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://github.com/contactandyc/another-c-library/blob/master/docs/tips.md#create-multiline-macro-in-c" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Helpful Tips for Formatting <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li><li><a href="https://mitpress.mit.edu/books/introduction-algorithms-third-edition" target="_blank" rel="noopener noreferrer" style="color:#3182CE">Introduction to Alogorithms <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 576 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M576 24v127.984c0 21.461-25.96 31.98-40.971 16.971l-35.707-35.709-243.523 243.523c-9.373 9.373-24.568 9.373-33.941 0l-22.627-22.627c-9.373-9.373-9.373-24.569 0-33.941L442.756 76.676l-35.703-35.705C391.982 25.9 402.656 0 424.024 0H552c13.255 0 24 10.745 24 24zM407.029 270.794l-16 16A23.999 23.999 0 0 0 384 303.765V448H64V128h264a24.003 24.003 0 0 0 16.97-7.029l16-16C376.089 89.851 365.381 64 344 64H48C21.49 64 0 85.49 0 112v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V287.764c0-21.382-25.852-32.09-40.971-16.97z"></path></svg></a></li></ul></div></div></footer></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/ebook/2-timing/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-fb5291d31b0f12597e81.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-44b37c3d0621676eebb5.js"],"component---src-templates-ebook-page-js":["/component---src-templates-ebook-page-js-4f86bfce78e35e0955d6.js"],"component---src-pages-404-js":["/component---src-pages-404-js-43d144517b29d5889d0f.js"],"component---src-pages-contact-js":["/component---src-pages-contact-js-75a1998efa7b299455c5.js"],"component---src-pages-contributing-js":["/component---src-pages-contributing-js-e9dc3e8dd486904c9d93.js"],"component---src-pages-docs-js":["/component---src-pages-docs-js-2cd44d59460d18e08591.js"],"component---src-pages-ebook-js":["/component---src-pages-ebook-js-d3f2fceb0db47cb8c846.js"],"component---src-pages-index-js":["/component---src-pages-index-js-0152ebc0b4226a6515fa.js"],"component---src-pages-license-js":["/component---src-pages-license-js-a84ed4b0fd7b4af796e8.js"]};/*]]>*/</script><script src="/webpack-runtime-277776b5a5692f7fc3b0.js" async=""></script><script src="/styles-a8f8354e20700922ebe9.js" async=""></script><script src="/app-fb5291d31b0f12597e81.js" async=""></script><script src="/commons-112db262b175fed05b80.js" async=""></script><script src="/component---src-templates-ebook-page-js-4f86bfce78e35e0955d6.js" async=""></script></body></html>